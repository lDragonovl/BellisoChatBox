@{
    ViewData["Title"] = "Cart";
    Layout = "~/Views/Shared/_Layout1.cshtml";
}
@model BusinessObject.Model.DataResult
@{
    var list = Model.Result as List<BusinessObject.Model.Page.UserCartData>;
    double cartPrice = 0;
}

<section style="background-color: #f5f5f5;" class="gallery_section layout_padding">


<div class="container-fluid">
@if (list.Count() > 0)
        {
            <div style="margin-bottom: 30px;" class="heading_container justify-content-center">
                <h2>
                    Giỏ hàng
                </h2>
            </div>
    <div class="row px-xl-5">
                <div class="col-lg-8 justify-between">
                    <table class="table table-light table-borderless table-hover text-center mb-0">
                        <thead class="thead-dark">
                <th>
                    <div class="flex justify-center">
                        <label class="relative flex items-center rounded-full cursor-pointer !mb-1"
                               htmlFor="red">
                            <input type="checkbox"
                                   class="before:content[''] peer relative h-5 w-5 cursor-pointer appearance-none rounded-md border border-blue-gray-200 transition-all before:absolute before:top-2/4 before:left-2/4 before:block before:h-12 before:w-12 before:-translate-y-2/4 before:-translate-x-2/4 before:rounded-full before:bg-blue-gray-500 before:opacity-0 before:transition-opacity checked:border-red-500 checked:bg-red-500 checked:before:bg-red-500 hover:before:opacity-10
                              "
                                   id="all" />
                            <span class="absolute text-white transition-opacity opacity-0 pointer-events-none top-2/4 left-2/4 -translate-y-2/4 -translate-x-2/4 peer-checked:opacity-100">
                               
                            </span>
                        </label>
                    </div>
                </th>
                <th></th>
                <th>Sản phẩm</th>
                <th>Giá</th>
                <th>Số lượng</th>
                <th>Tổng cộng</th>
                <th>Xoá</th>
                </thead>
                <tbody>
                    @foreach (var item in list)
                    {

                        var priceDiscount = item.Product.ProPrice - (item.Product.ProPrice * item.Product.Discount) / 100;
                        priceDiscount = Math.Round(priceDiscount, 2);

                        <tr>
                            <td class="align-middle text-center">
                                <div class="inline-flex items-center">
                                    @if (item.Product.ProQuan > 0)
                                    {
                                        <label class="relative flex items-center p-3 rounded-full cursor-pointer " for="red">
                                            <input type="checkbox" data-priceId="@item.Product.ProId" class="check-box-child before:content[''] peer relative h-5 w-5 cursor-pointer appearance-none rounded-md border border-red transition-all before:absolute before:top-2/4 before:left-2/4 before:block before:h-12 before:w-12 before:-translate-y-2/4 before:-translate-x-2/4 before:rounded-full before:bg-blue-gray-500 before:opacity-0 before:transition-opacity checked:border-red-500 checked:bg-red-500 checked:before:bg-red-500 hover:before:opacity-10" id="red" value="59"><span class="absolute text-white transition-opacity opacity-0 pointer-events-none top-2/4 left-2/4 -translate-y-2/4 -translate-x-2/4 peer-checked:opacity-100">
                 
                                            </span>
                                        </label>
                                    }
                                    else
                                    {
                                        <p class="bg-gray-500 text-white p-2 rounded-[20px]">Hết hàng</p>
                                    }
                                </div>
                            </td>
                                    <td> <img style="width:50px" src="@item.Product.ProImg[0]" alt="" class="w-[100px] mr-3"></td>
                            <td>
                                <a class="flex items-center text-[#3d464d] hover:text-[#3d464d] hover:no-underline" href="/ProductDetail?ProId=@item.Product.ProId">
                                   
                                    <div>
                                        <span class="font-medium ">@item.Product.ProName</span>
                                        <br>
                                        <span>Stock: @item.Product.ProQuan</span>
                                    </div>
                                </a>
                            </td>
                            <td class="align-middle text-lg">
                                        <span id="dp-@item.Product.ProId">@priceDiscount.ToString("N0")₫</span>
                            </td>
                            <td class="align-middle">
                                <div class="d-flex align-items-center">
                                    <div class="input-group !w-[130px]">
                                        <div class="input-group-btn">
                                            <button class="btn btn-primary btn-minus" onclick="handleDecrease(this)" @(item.Product.ProQuan == 0 ? "disabled" : "")><i class="fa fa-minus"></i></button>
                                        </div>
                                        <input onchange="UpdateCart(this)" type="text" class="form-control bg-secondary border-0 text-center" data-proQuan="@item.Product.ProQuan" data-proID="@item.Product.ProId" value="@item.model.Quantity" @(item.Product.ProQuan == 0 ? "readonly" : "")>
                                        <div class="input-group-btn">
                                            <button class="btn btn-primary btn-plus" onclick="handleIncrease(this)" @(item.Product.ProQuan == 0 ? "disabled" : "")><i class="fa fa-plus"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </td>
                            <td class="align-middle text-lg max-w-5">
                                        <span id="total-@item.Product.ProId">@item.model.Price</span>
                            </td>
                            <td class="align-middle">
                                <button class="btn-common btn mt-0 " data-proId="@item.Product.ProId" onclick="DeleteItem(this)">
                                    <i class="fa solid fa-trash text-[#3d464d]"></i>
                                </button>
                            </td>
                        </tr>

                        cartPrice += item.model.Price;
                    }
                </tbody>
            </table>
            </div>
                <div class="col-lg-4">
                    
                    <h5 class="section-title position-relative text-uppercase mb-3"><span>Tóm tắt giỏ hàng</span></h5>
                    <div class="bg-white w-[25%] mr-[15px] p-4 h-fit rounded-xl shadow-md">
                        <div class="flex justify-between font-semibold text-2xl text-[#3D464D]">
                            <span style="font-weight:bold; font-size:30px;">Tổng cộng</span>
                            <span style="margin-left:30%;font-weight:bold; font-size:30px;" id="cartTotalPrice"></span>
                        </div>
                        <button id="btnLogin" class="btn-common btn-common-lg w-full" style=" color: #3d464d ;
    font-size: 1rem;
    padding: 0.375rem 0.75rem;
    background-color: #ffc107;
    margin-top: 10px;
    outline: none !important;
    border:none !important;
    width: 100%;
    font-weight:bold;
font-size: 1.25rem;
    padding: 0.5rem 1rem;" onclick="CheckOut()">
                            Thanh toán
                        </button>
                    </div>
                </div>
         </div>

  
}
else
{
    <div class="m-auto w-fit text-center">
        <img src="~/source_img/advertising_img/order-placed-purchased-icon.webp" alt="" />
        <h3>
            Giỏ hàng của bạn đang trống <br /> Nhấp vào <a href="/shop">" đây "</a> để mua hàng
         
        </h3>
    </div>
        }


</section>

<link href="~/css/alert.css" rel="stylesheet" />
<div class="alert  d-flex" id="alert-message">
    <span class="fas fa-exclamation-circle"></span>
    <span class="msg" id="alert-message-msg"></span>
    <div class="close-btn" id="close-btn-alert" onclick="handleCloseAlert()">
        <span class="fas fa-times"></span>
    </div>
</div>


<script>
    const CheckOut = () => {
        if (sessionStorage.getItem("ProId")) {
            window.location.href = "/Order";
        } else {
            var msg = $('#alert-message-msg');

            msg.text('You must have select product!');
            alertMessage();
        }
    }

    const handleCloseAlert = (id) => {
        $('#alert-message').addClass("hide");
        $('#alert-message').removeClass("show");
    }

    function alertMessage() {
        $('#alert-message').removeClass("hide");
        $('#alert-message').addClass("show");
        $('#alert-message').addClass("showAlert");

        setTimeout(function () {
            $('#alert-message').addClass("hide");
            $('#alert-message').removeClass("show");
        }, 2000)
    }
</script>